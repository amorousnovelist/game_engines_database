# Курсовой проект "Разработка файловой базы данных"
## Условие задачи
Разработать консольный менеджер (программа) для работы с базой данных "игровые движки".
Консольный менеджер (программа) должен предоставлять меню с функциями:
- Загрузка данных из файла
- Просмотр всех записей
- Поиск по заданному диапазону
- Сортировка данных
- Добавление новой записи
- Сохранение данных в файл
- Выход

Поля базы данных должны включать:
- Название
- Технология рендеринга
- Макс. полигонов в сцене
- Поддерживаемые платформы
- Качество физики
- Стоимость лицензии
- Сообщество
- Документация

## 1. Алгоритм и блок-схема
### Алгоритм
1. Начало
2. Включить кодировку `Windows 1251`
3. Объявить переменные
`p_database = NULL` - указатель на динамическую память, которая хранит в себе массив структур (записи базы данных). Определяется NULL для последующих валидаций команд.
`records_count` - количество записей в базе данных. Определяется во время инициализации первой записи, инкрементируется во время добавления последующих записей.
`choice` - буфер для ввода команд.
4. Вывести на экран приветственное сообщение.
5. Вывести на экран меню команд.
6. Начать цикл ввода команд от пользователя с последующей валидацией.
7. Завершить цикл ввода команд от пользователя, если пользователь выбрал команду "Выход".
8. Конец

### Блок-схема главной функции (программы)

<img width="536" height="682" alt="main drawio" src="https://github.com/user-attachments/assets/35975a7d-7998-4863-b8aa-7bd0f552c28f" />

### Блок-схемы команд программы
1. Команда загрузка данных из файла

<img width="102" height="522" alt="d drawio" src="https://github.com/user-attachments/assets/d4ec6a52-b3c6-4560-b395-485b4ff240c2" />

2. Команда просмотра записей

<img width="352" height="392" alt="v drawio" src="https://github.com/user-attachments/assets/e4e3e507-60cc-47da-b69d-69dcb347fab9" />

3. Команда поиска записей в заданном диапазоне

<img width="836" height="992" alt="r drawio" src="https://github.com/user-attachments/assets/5bcfe887-3453-4216-add4-3a5f353ee6c9" />

4. Команда сортировки записей

<img width="142" height="382" alt="s drawio" src="https://github.com/user-attachments/assets/bb7ec128-e753-4149-8ab0-5c7371e9e76c" />

5. Команда добавления записи с пользовательскими данными в текущую (открытую) базу данных

<img width="254" height="562" alt="a drawio(1)" src="https://github.com/user-attachments/assets/3bcb2e9a-5557-4f7d-9b7e-f56a4bdc8c2e" />

6. Команда добавления записи с тестовыми случайными данными в текущую (открытую) базу данных

<img width="254" height="562" alt="t drawio" src="https://github.com/user-attachments/assets/8ccf7025-d2d7-44f4-aa08-9ee055252653" />

7. Команда записи текущей (открытой) базы данных в файл

<img width="102" height="362" alt="w drawio" src="https://github.com/user-attachments/assets/3dd38da8-dfe3-423e-b159-5075d2389b4a" />

8. Команда отображения веса текущей (открытой) базы данных в байтах

<img width="297" height="577" alt="o drawio" src="https://github.com/user-attachments/assets/1c7dafb9-977e-4b39-ab7e-f5dde6c32b2f" />

9. Команда отображения меню

<img width="142" height="202" alt="m drawio" src="https://github.com/user-attachments/assets/18a348a9-159a-4c5b-a807-3e2b77980610" />

10. Команда завершения работы программы

<img width="102" height="222" alt="q drawio" src="https://github.com/user-attachments/assets/729d0a0b-0615-47c9-a69e-f5c4183ac37d" />

## 2. Описание ключевых функций
Функция
```
int init_record(ENGINES *database, const size_t count, \
	const char *name, \
	const char *tech_render, \
	const unsigned polygons, \
	const struct supported_platforms *supported_platforms, \
	const char physics_quality, \
	const unsigned license_cost, \
	const char *community, \
	const char *doc, \
	const float rating);
```
инициализирует поля записи открытой базы данных, на которую указывает параметр database, индекс записи в базе данных указывается в параметре count. Каждый параметр после параметра индекса, соответствует одноименному полю записи. Функция возвращает 0 в случае успешного завершения; 1 в случае ошибки выделения памяти.

Функция
```
int print_record(ENGINES *database, const size_t count);
```
печатает запись открытой базы данных, на которую указывает параметр database, по индексу. Индекс записи в базе данных указывается в параметре count. Функция возвращает 0 в случае успешного завершения.

Функция
```
size_t calculate_record_size(ENGINES *record);
```
считает вес записи в базе данных в байтах, на которую указывает параметр record. Функция возвращает размер записи, занимаемый ею в оперативной памяти.

Функция
```
int store_data(const char *data_name, ENGINES *database, const size_t records_count);
```
сохраняет открытую базу данных в файл в бинарном формате. Параметр data_name должен содержать имя файла, в который будет записана база данных, параметр database является указателем на открытую базу данных, параметр records_count содержит в себе количество записей в базе данных. Фукнция возвращает 0 в случае успешного завершения; 1 в случае ошибки открытия файла.

Функция
```
ENGINES* read_data(const char *data_name, size_t *records_count);
```
читает базу данных из файла в бинарном формате. Параметр data_name должен содержать имя файла, из которого будет прочитана база данных, параметр records_count является указателем на количество записей, которое будет прочитано из открытого файла. Функция возвращает указатель на прочитанную базу данных.

Функция
```
void gnome_sort(ENGINES *database, const size_t count);
```
сортирует открытую базу данных по количеству полигонов в сцене. Параметр database является указателем на открытую базу данных, которую нужно отсортировать, параметр count содержит в себе количество записей в базе данных.
## 3. Контрольные примеры заполненной базы данных
Контрольный пример данных для записи 1:
```
Наименование: Unity
Тех. рендер: Ray Tracing
Макс. полигонов: 1000000
Поддерживаемые платфомы: Windows
Качество физики: A
Цена лицензии: 100
Сообщество: https://godotengine.org/community
Документация: https://docs.godotengine.org
Рейтинг: 3.5
```
Запись 1 с данными контрольного примера в открытой базе данных:

<img width="1526" height="950" alt="изображение" src="https://github.com/user-attachments/assets/77aaad4a-bdcb-473c-8b0a-ef0039be0b7d" />

Контрольный пример данных для записи 2:
```
Наименование: GameMaker
Тех. рендер: Voxel Cone Tracing
Макс. полигонов: 1005000
Поддерживаемые платформы: MacOS, Windows, Linux
Качество физики: A
Цена лицензии: 200
Сообщество: https://godotengine.org/community
Документация: https://docs.godotengine.org
Рейтинг: 4.5
```
Запись 2 с данными контрольного примера в открытой базе данных:

<img width="1516" height="946" alt="изображение" src="https://github.com/user-attachments/assets/01aa3d4d-e3b6-4023-871c-8c4702b802c3" />

## 4. Формат данных
Программа реализует формат данных как структуру на основе динамических массивов символов (строк), 
связного списка, структура которого включает в себя динамический массив символов (строку) и указатель на следующий элемент списка и которая описана в этом же файле, 
беззнаковых целочисленных переменных, 
переменной с плавующей точкой и символьной переменной. 
Реализовано эффективное выравнивание памяти относительно выравнивания наибольшего элемента структуры (общий размер структуры должен быть кратен его весу): сперва идет описание указателей на динамические строки, которые весят 8Б, затем идет указатель на связный список, который тоже весит 8Б, беззнаковые целочисленные переменные и переменная с плавующей точкой, которые весят 4Б, и символьная переменная, которая весит 1Б.
Благодаря такому расположению описаний компилятору необходимо добавить всего 3 padding-байта для того, чтобы вес структуры стал кратен 8Б. (вес структуры без padding-байтов - 53Б. Ближайшее допустимое кратное - 56Б. 56Б - 53Б = 3Б).
```
struct supported_platforms {
	char *name;
	struct supported_platforms *next;
};

typedef struct engines {
	char *name;
	char *tech_render;
	char *community;
	char *doc;
	struct supported_platforms *supported_platforms;
	
	unsigned polygons;
	unsigned license_cost;
	float rating;

	char physics_quality;
} ENGINES;
```
## 5. Реализация программы
Реализация программы представлена в файлах репозитория.
## 6. Результаты работы программы

<img width="1516" height="830" alt="изображение" src="https://github.com/user-attachments/assets/c15cbae7-13a5-4af6-abfa-ddc88fcf7b2e" />

## 7. Информация о разработчике
Илья Зеленев, бТИИ-251
